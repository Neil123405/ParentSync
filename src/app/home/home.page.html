<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title class="parent-sync-title">ParentSync</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="ion-padding content-with-footer">
  <ion-refresher slot="fixed" (ionRefresh)="refreshData($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <!-- Announcements Filters -->
  <div class="filter-row filter-card">
    <ion-item>
      <ion-label>Student</ion-label>
      <!-- the value is based on the selected student which is the ion-select-option -->
      <ion-select [(ngModel)]="announcementStudentFilter" interface="popover">
        <ion-select-option value="">All</ion-select-option>
        <ion-select-option *ngFor="let child of laravelChildren" [value]="child.student_id">
          {{ child.first_name }} {{ child.last_name }}
        </ion-select-option>
      </ion-select>
    </ion-item>
    <ion-item>
      <ion-label>Sort</ion-label>
      <ion-select [(ngModel)]="announcementSort" interface="popover">
        <ion-select-option value="latest">Latest</ion-select-option>
        <ion-select-option value="oldest">Oldest</ion-select-option>
      </ion-select>
    </ion-item>
    <ion-item class="show-input-item">
      <div class="show-input-container">
    <ion-label class="show-label">Show</ion-label>
    <ion-input
      type="number"
      [(ngModel)]="announcementLimit"
      min="1"
      class="centered-number-input"
      style="width: 60px;"
    ></ion-input>
  </div>
    </ion-item>
  </div>

  <h2>Announcements</h2>
  <!-- Announcements List -->
  <ng-container *ngFor="let announcement of filteredAnnouncements">
    <div style="display: flex; align-items: center; margin-bottom: 6px;">
      <!-- Student photo/icon OUTSIDE the card -->
      <div style="margin-right: 16px; display: flex; align-items: center; justify-content: center;">
        <!-- gets the student by ID and checks if they have a photo URL -->
        <ng-container *ngIf="getStudentById(announcement.student_id)?.photo_url; else noPhoto">
          <img [src]="getStudentById(announcement.student_id)?.photo_url"
               alt="Student Photo"
               style="width: 48px; height: 48px; border-radius: 50%; object-fit: cover; border: 4px solid #fff; box-shadow: 0 0 0 2px #e0e0e0;" />
        </ng-container>
        <ng-template #noPhoto>
          <ion-icon name="person-circle" style="font-size: 48px; color: #888;"></ion-icon>
        </ng-template>
      </div>
      <!-- The announcement card -->
      <ion-card
        class="announcement-card"
        (click)="openAnnouncement(announcement)"
        style="flex: 1; cursor: pointer; display: flex; align-items: center;"
      >
        <ion-card-content style="flex: 1;">
          <h3>{{ announcement.title }}</h3>
        </ion-card-content>
      </ion-card>
    </div>
  </ng-container>

  <ion-item *ngIf="filteredAnnouncements.length === 0">
    <ion-label class="ion-text-center">
      No announcements available.
    </ion-label>
  </ion-item>

  <!-- Events Filters -->
  <div class="filter-row filter-card">
    <ion-item>
      <ion-label>Student</ion-label>
      <ion-select [(ngModel)]="eventStudentFilter" interface="popover">
        <ion-select-option value="">All</ion-select-option>
        <ion-select-option *ngFor="let child of laravelChildren" [value]="child.student_id">
          {{ child.first_name }} {{ child.last_name }}
        </ion-select-option>
      </ion-select>
    </ion-item>
    <ion-item>
      <ion-label>Sort</ion-label>
      <ion-select [(ngModel)]="eventSort" interface="popover">
        <ion-select-option value="latest">Latest</ion-select-option>
        <ion-select-option value="oldest">Oldest</ion-select-option>
      </ion-select>
    </ion-item>
    <ion-item class="show-input-item">
      <div class="show-input-container">
      <ion-label class="show-label">Show</ion-label>
      <ion-input
        type="number"
        [(ngModel)]="eventLimit"
        min="1"
        class="centered-number-input"
        style="width: 60px;"
      ></ion-input>
    </div>
    </ion-item>
  </div>

  <h2>What's Coming Up</h2>
  <!-- Events List -->
  <div *ngFor="let event of filteredEvents" class="event-list-item">
    <ion-card (click)="openEventDetail(event)" class="event-card-custom">
      <div style="display: flex; align-items: center; justify-content: space-between;">
        <div style="display: flex; align-items: center;">
          <div style="margin: 16px; display: flex; align-items: center; justify-content: center;">
            <ng-container *ngIf="getStudentById(event.student_id)?.photo_url; else eventNoPhoto">
              <img [src]="getStudentById(event.student_id)?.photo_url"
                   alt="Student Photo"
                   class="event-student-photo" />
            </ng-container>
            <ng-template #eventNoPhoto>
              <ion-icon name="person-circle" style="font-size: 40px; color: #3880ff;"></ion-icon>
            </ng-template>
          </div>
          <h3 style="margin: 0;">{{ event.title }}</h3>
        </div>
        <div style="margin-right: 16px; color: #222; font-weight: 500;">
          {{ event.date | date:'mediumDate' }}
        </div>
      </div>
    </ion-card>
  </div>
  <ion-item *ngIf="filteredEvents.length === 0">
    <ion-label>No events available.</ion-label>
  </ion-item>

  <!-- Add bottom padding to prevent content overlap with footer -->
  <div style="height: 80px;"></div>
</ion-content>