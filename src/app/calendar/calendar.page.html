<!-- <ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>ParentSync - Calendar</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="refreshData()">
        <ion-icon name="refresh" slot="icon-only"></ion-icon>
      </ion-button>
      <ion-button (click)="logout()">
        <ion-icon name="log-out" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header> -->
// *ngFor

<!-- <ion-header>
  <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 16px; text-align: center;">
    <h2 style="margin: 0;">Current Location: {{ currentLocation }}</h2>
    <p style="margin: 0;">Date Today: {{ localDate | date:'fullDate' }}</p>
  </div>
</ion-header> -->

<ion-content [fullscreen]="true" style="--padding-top: 0; --padding-bottom: 0;">
  <ion-refresher slot="fixed" (ionRefresh)="doRefresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>
  <!-- <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 40px; text-align: center;">
  </div> --> <div class="smiling-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 40px; text-align: center; height: 300px;">
    <h1 style="font-size: 2.5rem; margin: 0;">Welcome to Your Calendar</h1>
  <p style="font-size: 1.2rem; margin: 10px 0;">Manage your events and consent forms easily</p>
  <p style="font-size: 1.2rem; margin: 10px 0;">
    <strong>{{ currentMonth }}</strong>
  </p>
  <p style="font-size: 1.2rem; margin: 10px 0;">
    Consent Forms: <strong>{{ consentFormCount }}</strong> | Events: <strong>{{ eventCount }}</strong>
  </p>
  </div>
    <ion-card-content>
      <!-- FullCalendar Component -->
      <full-calendar [options]="calendarOptions" #calendar></full-calendar>
    </ion-card-content>
  <!-- <ion-card>
    <ion-card-header style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
      <ion-card-title style="color: white">School Calendar</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <div class="calendar-nav">
        <ion-button fill="clear" (click)="previousMonth()">
          <ion-icon name="chevron-back-outline"></ion-icon>
        </ion-button>
        <span class="calendar-month-label">
          {{ monthNames[currentMonth] }} {{ currentYear }}
        </span>
        <ion-button fill="clear" (click)="nextMonth()">
          <ion-icon name="chevron-forward-outline"></ion-icon>
        </ion-button>
      </div>
      <div class="calendar-view-wrapper">
        <div class="calendar-week-row">
          <span class="calendar-week-name" *ngFor="let d of weekDays">{{ d }}</span>
        </div>
        <div class="calendar-days-grid">
          <ng-container *ngFor="let week of calendarGrid">
            <div class="calendar-week">
              <span *ngFor="let day of week" class="calendar-day" [class.today]="isToday(day)"
                [class.selected]="isSelected(day)" [class.other-month]="!day?.inMonth"
                [class.no-events]="!day?.events?.length && !day?.forms?.length"
                (click)="(day?.events?.length || day?.forms?.length) ? dayClicked(day) : null">
                {{ day?.date ? day.date.getDate() : '' }}
                <span *ngIf="day?.events?.length" class="event-dot"></span>
                <span *ngIf="day?.forms?.length" class="form-dot"></span>
              </span>
            </div>
          </ng-container>
        </div>
      </div>
    </ion-card-content>
  </ion-card> -->

  <!-- Toggle Buttons -->
  <div class="ion-margin-bottom" style="display: flex; gap: 8px; justify-content: center;">
    <ion-button [fill]="showUpcomingEvents ? 'solid' : 'outline'" (click)="showUpcomingEvents = true">
      Upcoming Events
    </ion-button>
    <ion-button [fill]="!showUpcomingEvents ? 'solid' : 'outline'" (click)="showUpcomingEvents = false"
      class="consent-toggle-btn">
      Upcoming Consent Forms
    </ion-button>
  </div>

  <!-- Upcoming Events List -->
  <div [hidden]="!showUpcomingEvents || upcomingEvents.length === 0" class="upcoming-reminders ion-margin-bottom">
    <ion-card>
      <ion-card-header style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
        <ion-card-title style="color: white">Upcoming Events</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-list>
          <ion-item *ngFor="let event of upcomingEvents" (click)="openEventDetail(event)" button detail>
            <ion-icon name="calendar-outline" slot="start" color="primary"></ion-icon>
            <ion-label>
              <h3>{{ event.title }}</h3>
              <p>
                <ion-icon name="time-outline" style="vertical-align: middle; margin-right: 4px;"></ion-icon>
                {{ event.start | date:'mediumDate' }}
                <span *ngIf="event.meta?.description">- {{ event.meta.description }}</span>
              </p>

              <p *ngIf="event.meta?.student?.first_name && event.meta?.student?.last_name">
                <ion-icon name="person-circle-outline" style="vertical-align: middle; margin-right: 4px;"></ion-icon>
                <strong>Student:</strong> {{ event.meta.student.first_name }} {{ event.meta.student.last_name }}
              </p>
            </ion-label>
          </ion-item>
        </ion-list>
      </ion-card-content>
    </ion-card>
  </div>

  <!-- Upcoming Consent Forms List -->
  <div [hidden]="showUpcomingEvents || upcomingConsentForms.length === 0" class="upcoming-reminders ion-margin-bottom">
    <ion-card>
      <ion-card-header style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
        <ion-card-title style="color: white">Upcoming Consent Forms</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-list>
          <ion-item *ngFor="let form of upcomingConsentForms" (click)="openConsentFormDetail(form)" button detail>
            <ion-icon name="document-text-outline" slot="start" color="success"></ion-icon>
            <ion-label>
              <h3>{{ form.title }}</h3>
              <p>
                <ion-icon name="time-outline" style="vertical-align: middle; margin-right: 4px;"></ion-icon>
                Deadline: {{ form.deadline | date:'mediumDate' }}
                <span *ngIf="form.description">- {{ form.description }}</span>
              </p>
              <p *ngIf="form.student?.first_name && form.student?.last_name">
                <ion-icon name="person-circle-outline" style="vertical-align: middle; margin-right: 4px;"></ion-icon>
                <strong>Student:</strong> {{ form.student.first_name }} {{ form.student.last_name }}
              </p>
            </ion-label>
          </ion-item>
        </ion-list>
      </ion-card-content>
    </ion-card>
  </div>
  <div style="height: 80px;"></div>
</ion-content>