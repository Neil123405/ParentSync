<!-- <ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>ParentSync - Calendar</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="refreshData()">
        <ion-icon name="refresh" slot="icon-only"></ion-icon>
      </ion-button>
      <ion-button (click)="logout()">
        <ion-icon name="log-out" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header> -->
// *ngFor

<ion-header>
  <div class="smiling-header"
    style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 40px; text-align: center; height: 120px;">
    <div style="display: flex; justify-content: center; align-items: center; gap: 20px; margin: 10px 0;">
      <!-- Event Count Indicator (Blue) -->
      <span class="indicator event-indicator" title="Events This Month">
        {{ eventCount }}
      </span>
      <!-- Consent Form Count Indicator (Green) -->
      <span class="indicator consent-indicator" style="
        display: inline-block;
        width: 80px;
        height: 80px;
        background: #43a047;
        border-radius: 50%;
        font-size: 2rem;
        font-weight: bold;
        line-height: 80px;
      " title="Consent Forms This Month">
        {{ consentFormCount }}
      </span>
    </div>
    <div style="display: flex; justify-content: center; gap: 20px; margin-top: -10px;;">
      <span style="font-size: 1.8rem; 
        font-family: 'Segoe UI', Arial, sans-serif;
        
        font-weight: bold;">Events</span>
      <span style="font-size: 1.8rem; 
        font-family: 'Segoe UI', Arial, sans-serif; 
        font-weight: bold;">Forms</span>
    </div>
  </div>
</ion-header>

<ion-content [fullscreen]="true" style="--padding-top: 0; --padding-bottom: 0;">
  <ion-refresher slot="fixed" (ionRefresh)="doRefresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>
  <!-- <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 40px; text-align: center;">
  </div> -->
  <ion-card-content style="margin-top: 150px;">
    <!-- FullCalendar Component -->
    <full-calendar [options]="calendarOptions" #calendar></full-calendar>
  </ion-card-content>
  <!-- <ion-card>
    <ion-card-header style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
      <ion-card-title style="color: white">School Calendar</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <div class="calendar-nav">
        <ion-button fill="clear" (click)="previousMonth()">
          <ion-icon name="chevron-back-outline"></ion-icon>
        </ion-button>
        <span class="calendar-month-label">
          {{ monthNames[currentMonth] }} {{ currentYear }}
        </span>
        <ion-button fill="clear" (click)="nextMonth()">
          <ion-icon name="chevron-forward-outline"></ion-icon>
        </ion-button>
      </div>
      <div class="calendar-view-wrapper">
        <div class="calendar-week-row">
          <span class="calendar-week-name" *ngFor="let d of weekDays">{{ d }}</span>
        </div>
        <div class="calendar-days-grid">
          <ng-container *ngFor="let week of calendarGrid">
            <div class="calendar-week">
              <span *ngFor="let day of week" class="calendar-day" [class.today]="isToday(day)"
                [class.selected]="isSelected(day)" [class.other-month]="!day?.inMonth"
                [class.no-events]="!day?.events?.length && !day?.forms?.length"
                (click)="(day?.events?.length || day?.forms?.length) ? dayClicked(day) : null">
                {{ day?.date ? day.date.getDate() : '' }}
                <span *ngIf="day?.events?.length" class="event-dot"></span>
                <span *ngIf="day?.forms?.length" class="form-dot"></span>
              </span>
            </div>
          </ng-container>
        </div>
      </div>
    </ion-card-content>
  </ion-card> -->

  <!-- Toggle Buttons -->
  <!-- Modern Tab Switcher -->
  <div class="modern-tab-switcher">
    <div class="tab-slider-container">
      <div class="tab-background-slider" [style.transform]="'translateX(' + (showUpcomingEvents ? '0%' : '100%') + ')'">
      </div>

      <button class="modern-tab-button" [class.active]="showUpcomingEvents" (click)="showUpcomingEvents = true">
        <ion-icon name="calendar" class="tab-icon"></ion-icon>
        <span class="tab-text">Events</span>
      </button>

      <button class="modern-tab-button" [class.active]="!showUpcomingEvents" (click)="showUpcomingEvents = false">
        <ion-icon name="document-text" class="tab-icon"></ion-icon>
        <span class="tab-text">Forms</span>
      </button>
    </div>
  </div>

  <!-- Modern Content Cards -->
  <div class="modern-content-wrapper">
    <!-- Upcoming Events Card -->
    <div class="modern-card-container" [class.active]="showUpcomingEvents" [class.hidden]="!showUpcomingEvents">

      <div class="modern-card events-card">
        <div class="card-header">
          <div class="header-icon-wrapper events-theme">
            <ion-icon name="calendar" class="header-icon"></ion-icon>
          </div>
          <div class="header-content">
            <h2 class="card-title">Upcoming Events</h2>
            <p class="card-subtitle">{{ upcomingEvents.length }} event{{ upcomingEvents.length !== 1 ? 's' : '' }}
              scheduled</p>
          </div>
        </div>

        <div class="card-body" *ngIf="upcomingEvents.length > 0; else noEventsTemplate">
          <div class="event-item" *ngFor="let event of upcomingEvents; let i = index" (click)="openEventDetail(event)"
            [style.animation-delay]="i * 100 + 'ms'">

            <div class="event-date-badge">
              <span class="date-day">{{ event.start | date:'dd' }}</span>
              <span class="date-month">{{ event.start | date:'MMM' }}</span>
            </div>

            <div class="event-content">
              <h3 class="event-title">{{ event.title }}</h3>
              <div class="event-details">
                <div class="event-time">
                  <ion-icon name="time-outline" class="detail-icon"></ion-icon>
                  <span>{{ event.start | date:'EEEE, MMMM d' }}</span>
                </div>
                <div class="event-description" *ngIf="event.meta?.description">
                  <ion-icon name="information-circle-outline" class="detail-icon"></ion-icon>
                  <span>{{ event.meta.description }}</span>
                </div>
                <div class="event-student" *ngIf="event.meta?.student?.first_name">
                  <ion-icon name="person-circle-outline" class="detail-icon"></ion-icon>
                  <span>{{ event.meta.student.first_name }} {{ event.meta.student.last_name }}</span>
                </div>
              </div>
            </div>

            <div class="event-arrow">
              <ion-icon name="chevron-forward" class="arrow-icon"></ion-icon>
            </div>
          </div>
        </div>

        <ng-template #noEventsTemplate>
          <div class="empty-state">
            <ion-icon name="calendar-clear-outline" class="empty-icon"></ion-icon>
            <h3 class="empty-title">No Upcoming Events</h3>
            <p class="empty-subtitle">Your calendar is clear for now</p>
          </div>
        </ng-template>
      </div>
    </div>

    <!-- Upcoming Consent Forms Card -->
    <div class="modern-card-container" [class.active]="!showUpcomingEvents" [class.hidden]="showUpcomingEvents">

      <div class="modern-card forms-card">
        <div class="card-header">
          <div class="header-icon-wrapper forms-theme">
            <ion-icon name="document-text" class="header-icon"></ion-icon>
          </div>
          <div class="header-content">
            <h2 class="card-title">Consent Forms</h2>
            <p class="card-subtitle">{{ upcomingConsentForms.length }} form{{ upcomingConsentForms.length !== 1 ? 's' :
              '' }} pending</p>
          </div>
        </div>

        <div class="card-body" *ngIf="upcomingConsentForms.length > 0; else noFormsTemplate">
          <div class="form-item" *ngFor="let form of upcomingConsentForms; let i = index"
            (click)="openConsentFormDetail(form)" [style.animation-delay]="i * 100 + 'ms'">

            <div class="form-priority-badge">
              <ion-icon name="alert-circle" class="priority-icon"></ion-icon>
            </div>

            <div class="form-content">
              <h3 class="form-title">{{ form.title }}</h3>
              <div class="form-details">
                <div class="form-deadline">
                  <ion-icon name="time-outline" class="detail-icon"></ion-icon>
                  <span>Deadline: {{ form.deadline | date:'EEEE, MMMM d' }}</span>
                </div>
                <div class="form-description" *ngIf="form.description">
                  <ion-icon name="information-circle-outline" class="detail-icon"></ion-icon>
                  <span>{{ form.description }}</span>
                </div>
                <div class="form-student" *ngIf="form.student?.first_name">
                  <ion-icon name="person-circle-outline" class="detail-icon"></ion-icon>
                  <span>{{ form.student.first_name }} {{ form.student.last_name }}</span>
                </div>
              </div>
            </div>

            <div class="form-arrow">
              <ion-icon name="chevron-forward" class="arrow-icon"></ion-icon>
            </div>
          </div>
        </div>

        <ng-template #noFormsTemplate>
          <div class="empty-state">
            <ion-icon name="document-text-outline" class="empty-icon"></ion-icon>
            <h3 class="empty-title">No Pending Forms</h3>
            <p class="empty-subtitle">All consent forms are up to date</p>
          </div>
        </ng-template>
      </div>
    </div>
  </div>
   <div class="content-bottom-spacer"></div>
</ion-content>